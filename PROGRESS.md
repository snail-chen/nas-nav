# 项目进度文档

## 2025-12-01

### 功能更新
- **用户管理系统 (User Management)**:
  - **多用户支持**: 新增 `useAuth` Hook，支持管理员 (Admin) 和普通用户 (User) 角色。
  - **用户管理面板**: 在设置中新增 "Users" 选项卡（仅管理员可见），支持添加新用户和删除现有用户。
  - **密码修改**: 在设置中新增 "Profile" 选项卡，支持所有用户修改自己的密码。
  - **权限隔离**: 限制普通用户无法使用右键菜单编辑/删除应用，也无法看到添加应用按钮和用户管理选项。

- **界面中文化 (Interface Localization)**:
  - **全面汉化**: 将所有用户可见的界面文本（包括按钮、菜单、提示信息、表单标签等）全部替换为中文。
  - **日期格式化**: 顶部状态栏的日期和时间显示调整为 `zh-CN` 格式。
  - **反馈信息**: 优化了操作成功或失败的提示信息，使其更符合中文语境。

- **界面升级 (UI Upgrade)**:
  - **极简科技亮色风格 (Daylight Tech Style)**:
    - **明亮主题**: 响应用户需求，将登录页背景调整为明亮的 `slate-50`，配合细腻的网格纹理。
    - **鼠标互动**: 新增鼠标跟随光斑特效，背景中的大面积光晕会跟随鼠标移动，增加页面的互动性和灵动感。
    - **毛玻璃质感**: 增强了登录卡片的毛玻璃效果（Backdrop Blur），添加了噪点纹理和白色光边，提升精致感。
    - **可配置标题**: 登录页标题现在与系统设置中的 `siteTitle` 实时同步，强化品牌个性。

- **系统监控 (System Monitor)**:
  - **Dock 栏组件**: 在 Dock 栏新增 "系统监控" 图标。
  - **实时面板**: 点击图标弹出悬浮面板，展示 CPU、内存、存储、网络上下行的实时（模拟）数据，采用动态进度条和数据流动画。

- **Docker 部署支持 (Docker Deployment)**:
  - **全栈容器化**: 提供了完整的 `Dockerfile`，支持 Node.js 后端与 React 前端的一体化构建与运行。
  - **数据持久化**: 配置了 Volume 挂载点，确保用户数据 (`users.json`) 和配置 (`config.json`) 在容器重启后不丢失。
  - **Docker Compose**: 新增 `docker-compose.yml` 文件，简化部署流程，一键启动服务。

- **安全与风控 (Security & Risk Control)**:
  - **全栈架构升级**: 引入 Node.js Express 后端服务器，替代纯前端 LocalStorage 存储，提升安全性。
  - **IP 记录**: 登录时自动记录客户端 IP 地址。
  - **并发登录限制**:
    - **防撞库/共享**: 默认禁止同一账号在不同 IP 同时登录（后登录者会踢掉前者或被拦截，取决于策略，当前策略为：已登录者受保护，新登录者被拒绝并提示）。
    - **管理员豁免**: 管理员账号 (`admin`) 不受并发登录限制，可多设备同时在线。
    - **白名单机制**: 管理员可为特定普通用户开启 "允许同时登录" 白名单。
    - **会话管理**: 管理员可在用户列表中查看用户在线状态，并强制下线（清除会话）指定用户。
    - **可配置阈值**: 在设置中可调整 "登录保护阈值"（默认为 30 分钟），控制并发检测的会话有效期。

- **局域网管理 (LAN Manager)**:
  - **新增应用**: 添加了 "LAN Manager"（局域网管理）系统应用，默认集成且不可删除。
  - **设备扫描**: 支持一键扫描局域网内所有活跃设备（使用 `nmap` 技术），展示 IP、MAC 地址及主机名。
  - **网络唤醒 (WOL)**: 支持通过发送魔术包（Magic Packet）远程唤醒指定设备。
  - **环境适配**: Docker 镜像中集成了 `nmap` 工具，确保在容器环境中扫描功能正常运作。

- **交互体验 (UX)**:
  - **拖拽排序**: 实现了桌面应用图标的拖拽排序功能，用户可自由调整应用位置并自动保存。
  - **系统应用保护**: 实现了系统级应用（如 LAN Manager）的防删除保护机制，隐藏删除按钮及菜单选项。

### 代码质量 (Code Quality)
- **类型修复**: 修正了 `User` 接口定义，使其与后端 API 返回的数据结构保持一致（添加 `token`，`password` 设为可选）。
- **规范修复**: 修正了 `main.tsx` 中的导入路径，移除了不必要的 `.tsx` 后缀，符合 TypeScript/Vite 最佳实践。
- **文档更新**: 及时更新了项目进度文档，保持中英文对应（主要为中文）。

### 问题修复 (Bug Fixes)
- **设置保存修复**: 修复了设置修改后无法保存的问题。重构了前端 `useConfig` Hook，确保配置更新操作（`siteTitle`, `baseUrl`, `sessionTimeout`）能够正确调用后端 API 并持久化到 `config.json` 文件。
- **Windows 兼容性修复**: 
  - 修复了后端服务器在 Windows 环境下无法检测本地 IP 的问题（替换 `ip route` 为 `os.networkInterfaces`）。
  - 优化了 LAN Manager 的错误处理机制：
    - 增强了对 Windows 中文系统下 Nmap 缺失错误的检测逻辑（兼容乱码输出）。
    - 在控制台中隐藏了预期的 Nmap 缺失报错堆栈，改用友好的警告信息。
    - 修复了前端无法显示后端返回的详细错误信息的问题。
